var y=Object.defineProperty,W=Object.defineProperties,D=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var F=(a,t,e)=>t in a?y(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,l=(a,t)=>{for(var e in t||(t={}))x.call(t,e)&&F(a,e,t[e]);if(L)for(var e of L(t))K.call(t,e)&&F(a,e,t[e]);return a},d=(a,t)=>W(a,I(t));var b=(a,t)=>{var e={};for(var s in a)x.call(a,s)&&t.indexOf(s)<0&&(e[s]=a[s]);if(a!=null&&L)for(var s of L(a))t.indexOf(s)<0&&K.call(a,s)&&(e[s]=a[s]);return e};var V=(a,t)=>{for(var e in t)y(a,e,{get:t[e],enumerable:!0})},M=(a,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of H(t))!x.call(a,r)&&r!==e&&y(a,r,{get:()=>t[r],enumerable:!(s=D(t,r))||s.enumerable});return a};var $=a=>M(y({},"__esModule",{value:!0}),a);var B={};V(B,{default:()=>R});module.exports=$(B);var n=require("svelte/store");var C=({parser:a,key:t,params:e,translations:s,locale:r,fallbackLocale:i})=>{if(!(t&&r))return console.warn("[i18n]: No translation key or locale provided. Skipping translation..."),"";let o=(s[r]||{})[t];return i&&o===void 0&&(o=(s[i]||{})[t]),a.parse(o,e,r,t)},h=(...a)=>a.length?a.filter(t=>!!t).map(t=>{let e=`${t}`.toLowerCase();try{let[s]=Intl.Collator.supportedLocalesOf(t);if(!s)throw new Error(`[i18n]: '${t}' is non-standard.`);e=s}catch{console.warn(`[i18n]: Non-standard locale provided: '${t}'. Check your 'translations' and 'loaders' in i18n config...`)}return e}):[],T=(a,t)=>Object.keys(a||{}).reduce((e,s)=>{let r=a[s],i=t?`${t}.${s}`:`${s}`;return r&&typeof r=="object"?l(l({},e),T(r,i)):d(l({},e),{[i]:r})},{}),j=async a=>{try{return(await Promise.all(a.map(r=>{var i=r,{loader:e}=i,s=b(i,["loader"]);return new Promise(async o=>{let c;try{c=await e()}catch(P){console.error(`[i18n]: Failed to load translation. Verify your '${s.locale}' > '${s.key}' Loader.`),console.error(P)}o(d(l({loader:e},s),{data:c}))})}))).reduce((e,{key:s,data:r,locale:i})=>{if(!r)return e;let[o]=h(i);return d(l({},e),{[o]:T(d(l({},e[o]||{}),{[s]:r}))})},{})}catch(t){console.error(t)}return{}},k=a=>t=>{try{if(typeof t=="string")return t===a;if(typeof t=="object")return t.test(a)}catch{throw new Error("[i18n]: Invalid route config!")}return!1},N=(a,t)=>{let e=!0;try{e=Object.keys(a).filter(s=>a[s]!==void 0).every(s=>a[s]===t[s])}catch{}return e};var A=1e3*60*60*24,R=class{constructor(t){this.cachedAt=0;this.loadedKeys={};this.currentRoute=(0,n.writable)();this.config=(0,n.writable)();this.isLoading=(0,n.writable)(!1);this.promises=new Set;this.loading={subscribe:this.isLoading.subscribe,toPromise:(t,e)=>{let s=Array.from(this.promises).filter(r=>N({locale:h(t)[0],route:e},r)).map(({promise:r})=>r);return Promise.all(s)},get:()=>(0,n.get)(this.isLoading)};this.privateTranslations=(0,n.writable)({});this.translations={subscribe:this.privateTranslations.subscribe,get:()=>(0,n.get)(this.translations)};this.locales=d(l({},(0,n.derived)([this.config,this.privateTranslations],([t,e])=>{if(!t)return[];let{loaders:s=[]}=t,r=s.map(({locale:o})=>h(o)[0]),i=Object.keys(e).map(o=>h(o)[0]);return Array.from(new Set([...r,...i]))},[])),{get:()=>(0,n.get)(this.locales)});this.internalLocale=(0,n.writable)();this.loaderTrigger=(0,n.derived)([this.internalLocale,this.currentRoute],([t,e],s)=>{var r,i,o;t!==void 0&&e!==void 0&&(t!==((r=(0,n.get)(this.loaderTrigger))==null?void 0:r[0])||e!==((i=(0,n.get)(this.loaderTrigger))==null?void 0:i[1]))&&((o=(0,n.get)(this.config))!=null&&o.debug&&console.debug("[i18n]: Triggering translation load..."),s([t,e]))},[]);this.localeHelper=(0,n.writable)();this.locale={subscribe:this.localeHelper.subscribe,forceSet:this.localeHelper.set,set:this.internalLocale.set,update:this.internalLocale.update,get:()=>(0,n.get)(this.locale)};this.initialized=(0,n.derived)([this.locale,this.currentRoute,this.privateTranslations],([t,e,s],r)=>{(0,n.get)(this.initialized)||r(t!==void 0&&e!==void 0&&!!Object.keys(s).length)});this.translation=(0,n.derived)([this.privateTranslations,this.locale,this.isLoading],([t,e,s],r)=>{let i=t[e];i&&Object.keys(i).length&&!s&&r(i)},{});this.t=d(l({},(0,n.derived)([this.config,this.translation],([{parser:t,fallbackLocale:e}])=>(s,...r)=>C({parser:t,key:s,params:r,translations:this.translations.get(),locale:this.locale.get(),fallbackLocale:e}))),{get:(t,...e)=>(0,n.get)(this.t)(t,...e)});this.l=d(l({},(0,n.derived)([this.config,this.translations],([{parser:t,fallbackLocale:e},s])=>(r,i,...o)=>C({parser:t,key:i,params:o,translations:s,locale:r,fallbackLocale:e}))),{get:(t,e,...s)=>(0,n.get)(this.l)(t,e,...s)});this.getLocale=t=>{if(!t)return"";let s=this.locales.get().find(r=>r===h(t)[0])||"";return h(s)[0]||""};this.setLocale=t=>{var s;if(!t)return;let[e]=h(t);if(e!==(0,n.get)(this.internalLocale))return(s=(0,n.get)(this.config))!=null&&s.debug&&console.debug(`[i18n]: Setting '${e}' locale.`),this.internalLocale.set(e),this.loading.toPromise(t,(0,n.get)(this.currentRoute))};this.setRoute=t=>{var e;if(t!==(0,n.get)(this.currentRoute)){(e=(0,n.get)(this.config))!=null&&e.debug&&console.debug(`[i18n]: Setting '${t}' route.`),this.currentRoute.set(t);let s=(0,n.get)(this.internalLocale);return this.loading.toPromise(s,t)}};this.loadConfig=async t=>{await this.configLoader(t)};this.getTranslationProps=async(t=this.locale.get(),e=(0,n.get)(this.currentRoute))=>{let s=(0,n.get)(this.config);if(!s||!t)return[];let r=this.translations.get(),{loaders:i,fallbackLocale:o="",cache:c=A}=s||{},P=Number.isNaN(+c)?A:+c;this.cachedAt?Date.now()>P+this.cachedAt&&(s!=null&&s.debug&&console.debug("[i18n]: Refreshing cache."),this.loadedKeys={},this.cachedAt=0):(s!=null&&s.debug&&console.debug("[i18n]: Setting cache timestamp."),this.cachedAt=Date.now());let[v,S]=h(t,o),E=r[v],O=r[S],w=(i||[]).map(z=>{var u=z,{locale:g}=u,f=b(u,["locale"]);return d(l({},f),{locale:h(g)[0]})}).filter(({routes:g})=>!g||(g||[]).some(k(e))).filter(({key:g,locale:f})=>f===v&&(!E||!(this.loadedKeys[v]||[]).includes(g))||o&&f===S&&(!O||!(this.loadedKeys[S]||[]).includes(g)));if(w.length){this.isLoading.set(!0),s!=null&&s.debug&&console.debug("[i18n]: Fetching translations...");let g=await j(w);this.isLoading.set(!1);let f=Object.keys(g).reduce((u,p)=>d(l({},u),{[p]:Object.keys(g[p])}),{}),z=w.filter(({key:u,locale:p})=>(f[p]||[]).some(m=>`${m}`.startsWith(u))).reduce((u,{key:p,locale:m})=>d(l({},u),{[m]:[...u[m]||[],p]}),{});return[g,z]}return[]};this.addTranslations=(t,e)=>{var r;if(!t)return;(r=(0,n.get)(this.config))!=null&&r.debug&&console.debug("[i18n]: Adding translations...");let s=Object.keys(t||{});this.privateTranslations.update(i=>s.reduce((o,c)=>d(l({},o),{[c]:l(l({},o[c]||{}),T(t[c]))}),i)),s.forEach(i=>{let o=Object.keys(t[i]).map(c=>`${c}`.split(".")[0]);e&&(o=e[i]),this.loadedKeys[i]=Array.from(new Set([...this.loadedKeys[i]||[],...o||[]]))})};this.loader=async([t,e])=>{var r;(r=(0,n.get)(this.config))!=null&&r.debug&&console.debug("[i18n]: Adding loader promise.");let s=(async()=>{let i=await this.getTranslationProps(t,e);i.length&&this.addTranslations(...i)})();this.promises.add({locale:t,route:e,promise:s}),s.then(()=>{let i=this.getLocale(t);i&&this.locale.get()!==i&&this.locale.forceSet(i)})};this.loadTranslations=(t,e=(0,n.get)(this.currentRoute)||"")=>{if(!!t)return this.setRoute(e),this.setLocale(t),this.loading.toPromise(t,e)};t&&this.loadConfig(t),this.loaderTrigger.subscribe(this.loader),this.isLoading.subscribe(async e=>{var s;e&&this.promises.size&&(await this.loading.toPromise(),this.promises.clear(),(s=(0,n.get)(this.config))!=null&&s.debug&&console.debug("[i18n]: Loader promises have been purged."))})}async configLoader(t){if(!t)throw new Error("[i18n]: No config provided!");let c=t,{initLocale:e,fallbackLocale:s,translations:r,debug:i}=c,o=b(c,["initLocale","fallbackLocale","translations","debug"]);[e]=h(e),[s]=h(s),i&&console.debug("[i18n]: Setting config."),this.config.set(l({initLocale:e,fallbackLocale:s,translations:r,debug:i},o)),r&&this.addTranslations(r),await this.loadTranslations(e)}};0&&(module.exports={});
