var y=Object.defineProperty,W=Object.defineProperties,D=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var z=(a,e,t)=>e in a?y(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,l=(a,e)=>{for(var t in e||(e={}))x.call(e,t)&&z(a,t,e[t]);if(L)for(var t of L(e))K.call(e,t)&&z(a,t,e[t]);return a},d=(a,e)=>W(a,I(e)),V=a=>y(a,"__esModule",{value:!0});var b=(a,e)=>{var t={};for(var s in a)x.call(a,s)&&e.indexOf(s)<0&&(t[s]=a[s]);if(a!=null&&L)for(var s of L(a))e.indexOf(s)<0&&K.call(a,s)&&(t[s]=a[s]);return t};var M=(a,e)=>{for(var t in e)y(a,t,{get:e[t],enumerable:!0})},q=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of H(e))!x.call(a,r)&&(t||r!=="default")&&y(a,r,{get:()=>e[r],enumerable:!(s=D(e,r))||s.enumerable});return a};var B=(a=>(e,t)=>a&&a.get(e)||(t=q(V({}),e,1),a&&a.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var J={};M(J,{default:()=>R});var n=require("svelte/store");var C=({parser:a,key:e,params:t,translations:s,locale:r,fallbackLocale:i})=>{if(!(e&&r))return console.warn("[i18n]: No translation key or locale provided. Skipping translation..."),"";let o=(s[r]||{})[e];return i&&o===void 0&&(o=(s[i]||{})[e]),a.parse(o,t,r,e)},h=(...a)=>a.length?a.filter(e=>!!e).map(e=>{let t=`${e}`.toLowerCase();try{[t]=Intl.Collator.supportedLocalesOf(e)}catch{console.warn(`[i18n]: Non-standard locale provided: '${a}'. Check your 'translations' and 'loaders' in i18n config...`)}return t}):[],T=(a,e)=>Object.keys(a||{}).reduce((t,s)=>{let r=a[s],i=e?`${e}.${s}`:`${s}`;return r&&typeof r=="object"?l(l({},t),T(r,i)):d(l({},t),{[i]:r})},{}),j=async a=>{try{return(await Promise.all(a.map(r=>{var i=r,{loader:t}=i,s=b(i,["loader"]);return new Promise(async o=>{let c;try{c=await t()}catch(P){console.error(`[i18n]: Failed to load translation. Verify your '${s.locale}' > '${s.key}' Loader.`),console.error(P)}o(d(l({loader:t},s),{data:c}))})}))).reduce((t,{key:s,data:r,locale:i})=>{if(!r)return t;let[o]=h(i);return d(l({},t),{[o]:T(d(l({},t[o]||{}),{[s]:r}))})},{})}catch(e){console.error(e)}return{}},k=a=>e=>{try{if(typeof e=="string")return e===a;if(typeof e=="object")return e.test(a)}catch{throw new Error("[i18n]: Invalid route config!")}return!1},N=(a,e)=>{let t=!0;try{t=Object.keys(a).filter(s=>a[s]!==void 0).every(s=>a[s]===e[s])}catch{}return t};var A=1e3*60*60*24,R=class{constructor(e){this.cachedAt=0;this.loadedKeys={};this.currentRoute=(0,n.writable)();this.config=(0,n.writable)();this.isLoading=(0,n.writable)(!1);this.promises=new Set;this.loading={subscribe:this.isLoading.subscribe,toPromise:(e,t)=>{let s=Array.from(this.promises).filter(r=>N({locale:h(e)[0],route:t},r)).map(({promise:r})=>r);return Promise.all(s)},get:()=>(0,n.get)(this.isLoading)};this.privateTranslations=(0,n.writable)({});this.translations={subscribe:this.privateTranslations.subscribe,get:()=>(0,n.get)(this.translations)};this.locales=d(l({},(0,n.derived)([this.config,this.privateTranslations],([e,t])=>{if(!e)return[];let{loaders:s=[]}=e,r=s.map(({locale:o})=>h(o)[0]),i=Object.keys(t).map(o=>h(o)[0]);return Array.from(new Set([...r,...i]))},[])),{get:()=>(0,n.get)(this.locales)});this.internalLocale=(0,n.writable)();this.loaderTrigger=(0,n.derived)([this.internalLocale,this.currentRoute],([e,t],s)=>{var r,i,o;e!==void 0&&t!==void 0&&(e!==((r=(0,n.get)(this.loaderTrigger))==null?void 0:r[0])||t!==((i=(0,n.get)(this.loaderTrigger))==null?void 0:i[1]))&&((o=(0,n.get)(this.config))!=null&&o.debug&&console.debug("[i18n]: Triggering translation load..."),s([e,t]))},[]);this.localeHelper=(0,n.writable)();this.locale={subscribe:this.localeHelper.subscribe,forceSet:this.localeHelper.set,set:this.internalLocale.set,update:this.internalLocale.update,get:()=>(0,n.get)(this.locale)};this.initialized=(0,n.derived)([this.locale,this.currentRoute,this.privateTranslations],([e,t,s],r)=>{(0,n.get)(this.initialized)||r(e!==void 0&&t!==void 0&&!!Object.keys(s).length)});this.translation=(0,n.derived)([this.privateTranslations,this.locale,this.isLoading],([e,t,s],r)=>{let i=e[t];i&&Object.keys(i).length&&!s&&r(i)},{});this.t=d(l({},(0,n.derived)([this.config,this.translation],([{parser:e,fallbackLocale:t}])=>(s,...r)=>C({parser:e,key:s,params:r,translations:this.translations.get(),locale:this.locale.get(),fallbackLocale:t}))),{get:(e,...t)=>(0,n.get)(this.t)(e,...t)});this.l=d(l({},(0,n.derived)([this.config,this.translations],([{parser:e,fallbackLocale:t},s])=>(r,i,...o)=>C({parser:e,key:i,params:o,translations:s,locale:r,fallbackLocale:t}))),{get:(e,t,...s)=>(0,n.get)(this.l)(e,t,...s)});this.getLocale=e=>{if(!e)return"";let s=this.locales.get().find(r=>r===h(e)[0])||"";return h(s)[0]||""};this.setLocale=e=>{var s;if(!e)return;let[t]=h(e);if(t!==(0,n.get)(this.internalLocale))return(s=(0,n.get)(this.config))!=null&&s.debug&&console.debug(`[i18n]: Setting '${t}' locale.`),this.internalLocale.set(t),this.loading.toPromise(e,(0,n.get)(this.currentRoute))};this.setRoute=e=>{var t;if(e!==(0,n.get)(this.currentRoute)){(t=(0,n.get)(this.config))!=null&&t.debug&&console.debug(`[i18n]: Setting '${e}' route.`),this.currentRoute.set(e);let s=(0,n.get)(this.internalLocale);return this.loading.toPromise(s,e)}};this.loadConfig=async e=>{await this.configLoader(e)};this.getTranslationProps=async(e=this.locale.get(),t=(0,n.get)(this.currentRoute))=>{let s=(0,n.get)(this.config);if(!s||!e)return[];let r=this.translations.get(),{loaders:i,fallbackLocale:o="",cache:c=A}=s||{},P=Number.isNaN(+c)?A:+c;this.cachedAt?Date.now()>P+this.cachedAt&&(s!=null&&s.debug&&console.debug("[i18n]: Refreshing cache."),this.loadedKeys={},this.cachedAt=0):(s!=null&&s.debug&&console.debug("[i18n]: Setting cache timestamp."),this.cachedAt=Date.now());let[v,S]=h(e,o),O=r[v],E=r[S],w=(i||[]).map(F=>{var u=F,{locale:g}=u,f=b(u,["locale"]);return d(l({},f),{locale:h(g)[0]})}).filter(({routes:g})=>!g||(g||[]).some(k(t))).filter(({key:g,locale:f})=>f===v&&(!O||!(this.loadedKeys[v]||[]).includes(g))||o&&f===S&&(!E||!(this.loadedKeys[S]||[]).includes(g)));if(w.length){this.isLoading.set(!0),s!=null&&s.debug&&console.debug("[i18n]: Fetching translations...");let g=await j(w);this.isLoading.set(!1);let f=Object.keys(g).reduce((u,p)=>d(l({},u),{[p]:Object.keys(g[p])}),{}),F=w.filter(({key:u,locale:p})=>(f[p]||[]).some(m=>`${m}`.startsWith(u))).reduce((u,{key:p,locale:m})=>d(l({},u),{[m]:[...u[m]||[],p]}),{});return[g,F]}return[]};this.addTranslations=(e,t)=>{var r;if(!e)return;(r=(0,n.get)(this.config))!=null&&r.debug&&console.debug("[i18n]: Adding translations...");let s=Object.keys(e||{});this.privateTranslations.update(i=>s.reduce((o,c)=>d(l({},o),{[c]:l(l({},o[c]||{}),T(e[c]))}),i)),s.forEach(i=>{let o=Object.keys(e[i]).map(c=>`${c}`.split(".")[0]);t&&(o=t[i]),this.loadedKeys[i]=Array.from(new Set([...this.loadedKeys[i]||[],...o||[]]))})};this.loader=async([e,t])=>{var r;(r=(0,n.get)(this.config))!=null&&r.debug&&console.debug("[i18n]: Adding loader promise.");let s=(async()=>{let i=await this.getTranslationProps(e,t);i.length&&this.addTranslations(...i)})();this.promises.add({locale:e,route:t,promise:s}),s.then(()=>{let i=this.getLocale(e);i&&this.locale.get()!==i&&this.locale.forceSet(i)})};this.loadTranslations=(e,t=(0,n.get)(this.currentRoute)||"")=>{if(!!e)return this.setRoute(t),this.setLocale(e),this.loading.toPromise(e,t)};e&&this.loadConfig(e),this.loaderTrigger.subscribe(this.loader),this.isLoading.subscribe(async t=>{var s;t&&this.promises.size&&(await this.loading.toPromise(),this.promises.clear(),(s=(0,n.get)(this.config))!=null&&s.debug&&console.debug("[i18n]: Loader promises have been purged."))})}async configLoader(e){if(!e)throw new Error("[i18n]: No config provided!");let c=e,{initLocale:t,fallbackLocale:s,translations:r,debug:i}=c,o=b(c,["initLocale","fallbackLocale","translations","debug"]);t=h(t)[0],s=h(s)[0],i&&console.debug("[i18n]: Setting config."),this.config.set(l({initLocale:t,fallbackLocale:s,translations:r,debug:i},o)),r&&this.addTranslations(r),await this.loadTranslations(t)}};module.exports=B(J);0&&(module.exports={});
